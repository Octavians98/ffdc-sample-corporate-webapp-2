{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"tslib\"","webpack:///external \"@nestjs/common\"","webpack:///external \"@nestjs/config\"","webpack:///external \"@ffdc/nestjs-oidc\"","webpack:///./apps/server/src/app.service.ts","webpack:///external \"@ffdc/api_corporate-accounts\"","webpack:///external \"@nestjs/core\"","webpack:///./apps/server/src/app.module.ts","webpack:///external \"@nestjs/serve-static\"","webpack:///external \"@ffdc/nestjs-proxy\"","webpack:///./apps/server/src/app.controller.ts","webpack:///./apps/server/src/configs/proxy-config.service.ts","webpack:///external \"@nestjs/graphql\"","webpack:///./apps/server/src/configs/graphql-config.service.ts","webpack:///./apps/server/src/configs/oidc-config.service.ts","webpack:///./apps/server/src/configs/serve-startic-config.service.ts","webpack:///external \"path\"","webpack:///external \"compression\"","webpack:///./apps/server/src/main.ts"],"names":[],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;AClFA,kC;;;;;;ACAA,2C;;;;;;ACAA,2C;;;;;;ACAA,8C;;;;;;;;;;;;;ACA4C;AAG5C,IAAa,UAAU,GAAvB,MAAa,UAAU;IACrB,QAAQ;QACN,OAAO,cAAc,CAAC;IACxB,CAAC;CACF;AAJY,UAAU;IADtB,iEAAU,EAAE;GACA,UAAU,CAItB;AAJsB;;;;;;;ACHvB,yD;;;;;;ACAA,yC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAwC;AACqB;AACJ;AACV;AACE;AACA;AACN;AACyB;AACpB;AACuB;AACH;AACF;AACkB;AA2BpF,IAAa,SAAS,GAAtB,MAAa,SAAS;CAAG;AAAZ,SAAS;IAzBrB,6DAAM,CAAC;QACN,OAAO,EAAE;YACP,2DAAY,CAAC,OAAO,CAAC;gBACnB,QAAQ,EAAE,IAAI;gBACd,aAAa,EAAE,YAAoB,KAAK,YAAY;aACrD,CAAC;YACF,4DAAU,CAAC,YAAY,CAAC;gBACtB,OAAO,EAAE,CAAC,2DAAY,CAAC;gBACvB,QAAQ,EAAE,uFAAiB;aAC5B,CAAC;YACF,sEAAiB,CAAC,YAAY,CAAC;gBAC7B,QAAQ,EAAE,yGAA0B;aACrC,CAAC;YACF,8DAAW,CAAC,YAAY,CAAC;gBACvB,QAAQ,EAAE,wFAAkB;gBAC5B,OAAO,EAAE,CAAC,2DAAY,CAAC;aACxB,CAAC;YACF,qFAAuB;YACvB,6DAAa,CAAC,YAAY,CAAC;gBACzB,QAAQ,EAAE,yFAAgB;aAC3B,CAAC;SACH;QACD,WAAW,EAAE,CAAC,qEAAa,CAAC;QAC5B,SAAS,EAAE,CAAC,+DAAU,CAAC;KACxB,CAAC;GACW,SAAS,CAAG;AAAH;;;;;;;ACvCtB,iD;;;;;;ACAA,+C;;;;;;;;;;;;;;;ACAqE;AAC1B;AAG3C,IAAa,aAAa,GAA1B,MAAa,aAAa;IACxB,YAA6B,UAAsB;QAAtB,eAAU,GAAV,UAAU,CAAY;IAAG,CAAC;IAGvD,IAAI,CAAY,GAAG;QACjB,OAAO,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC;IAC3B,CAAC;CACF;AAHC;IADC,0DAAG,CAAC,OAAO,CAAC;IACP,uHAAO,EAAE;;;;yCAEd;AANU,aAAa;IADzB,iEAAU,EAAE;uGAE8B,+DAAU,oBAAV,+DAAU;GADxC,aAAa,CAOzB;AAPyB;;;;;;;;;;;;;;;;;ACJqB;AACH;AAO5C,IAAa,kBAAkB,GAA/B,MAAa,kBAAkB;IAC7B,YAAoB,aAA4B;QAA5B,kBAAa,GAAb,aAAa,CAAe;IAAG,CAAC;IAEpD,kBAAkB;QAChB,MAAM,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAE5C,MAAM,QAAQ,GAAG;YACf;gBACE,EAAE,EAAE,oBAAoB;gBACxB,GAAG,EAAE,GAAG,IAAI,6CAA6C;aAC1D;SACF,CAAC;QAEF,OAAO;YACL,QAAQ;SACT,CAAC;IACJ,CAAC;CACF;AAjBY,kBAAkB;IAD9B,iEAAU,EAAE;uGAEwB,4DAAa,oBAAb,4DAAa;GADrC,kBAAkB,CAiB9B;AAjB8B;;;;;;;ACR/B,4C;;;;;;;;;;;;;;;ACC4C;AAC2B;AAGvE,IAAa,gBAAgB,GAA7B,MAAa,gBAAgB;IAC3B,gBAAgB;QACd,MAAM,oBAAoB,GAAG;YAC3B,QAAQ,EAAE;gBACR,qBAAqB,EAAE,SAAS;aACjC;SACF,CAAC;QACF,OAAO;YACL,SAAS,EAAE,CAAC,0DAA0D,CAAC;YACvE,OAAO,EAAE,CAAC,oFAAuB,CAAC;YAClC,UAAU,EACR,KAAqC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,SAAoB;SACvE,CAAC;IACJ,CAAC;CACF;AAdY,gBAAgB;IAD5B,iEAAU,EAAE;GACA,gBAAgB,CAc5B;AAd4B;;;;;;;;;;;;;;;;;ACLuB;AAEL;AAG/C,IAAa,iBAAiB,yBAA9B,MAAa,iBAAiB;IAG5B,YAAoB,aAA4B;QAA5B,kBAAa,GAAb,aAAa,CAAe;QAFvC,WAAM,GAAG,IAAI,qDAAM,CAAC,mBAAiB,CAAC,IAAI,CAAC,CAAC;IAEF,CAAC;IAEpD,kBAAkB;QAChB,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QACrD,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QAC3D,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CACnC,aAAa,EACb,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAC1E,CAAC;QAEF,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;eACL,MAAM;eACN,SAAS;eACT,MAAM,EAAE,CAAC,CAAC;QAErB,OAAO;YACL,MAAM;YACN,cAAc,EAAE;gBACd,SAAS;gBACT,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,oBAAoB,CAAC;aAC5D;YACD,UAAU,EAAE;gBACV,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,aAAa,CAAC;gBAC7C,QAAQ,EAAE,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,eAAe,CAAC;aAClD;YACD,MAAM;SACP,CAAC;IACJ,CAAC;IAEO,aAAa,CAAC,OAAe;QACnC,OAAO,WAAW,OAAO,gBAAgB,CAAC;IAC5C,CAAC;CACF;AAnCY,iBAAiB;IAD7B,iEAAU,EAAE;uGAIwB,4DAAa,oBAAb,4DAAa;GAHrC,iBAAiB,CAmC7B;AAnC6B;;;;;;;;;;;;;;;;;;;ACLc;AACG;AAKnB;AAG5B,IAAa,0BAA0B,GAAvC,MAAa,0BAA0B;IAIrC,YAAoB,aAA4B;QAA5B,kBAAa,GAAb,aAAa,CAAe;QAFhD,cAAS,GAAG,iDAAI,CAAC,SAAS,EAAE,UAAU,EAAE,kBAAkB,CAAC,CAAC;IAET,CAAC;IAEpD,mBAAmB;QACjB,OAAO;YACL;gBACE,QAAQ,EAAE,IAAI,CAAC,SAAS;aACzB;SACF,CAAC;IACJ,CAAC;CACF;AAbY,0BAA0B;IADtC,iEAAU,EAAE;uGAKwB,4DAAa,oBAAb,4DAAa;GAJrC,0BAA0B,CAatC;AAbsC;;;;;;;ACTvC,iC;;;;;;ACAA,wC;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAsD;AACb;AACmC;AAC7B;AAEJ;AAE3C,SAAe,SAAS;;QACtB,MAAM,GAAG,GAAG,MAAM,wDAAW,CAAC,MAAM,CAAC,6DAAS,CAAC,CAAC;QAEhD,MAAM,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC,4DAAa,CAAC,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QACzD,MAAM,UAAU,GAAG,MAAM,uEAAa,CAAC,MAAM,CAAC,CAAC;QAC/C,MAAM,SAAS,GAAG,GAAG,CAAC,GAAG,CAAC,sDAAS,CAAC,CAAC;QACrC,GAAG,CAAC,eAAe,CAAC,IAAI,4DAAU,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC,CAAC;QAE3D,GAAG,CAAC,GAAG,CAAC,wCAAW,EAAE,CAAC,CAAC;QAEvB,sEAAY,CAAC,GAAG,CAAC,CAAC;QAClB,mBAAmB;QAEnB,MAAM,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC;QACtC,MAAM,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACzB,CAAC;CAAA;AACD,SAAS,EAAE,CAAC","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n","module.exports = require(\"tslib\");","module.exports = require(\"@nestjs/common\");","module.exports = require(\"@nestjs/config\");","module.exports = require(\"@ffdc/nestjs-oidc\");","import { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class AppService {\n  getHello(): string {\n    return 'Hello World!';\n  }\n}\n","module.exports = require(\"@ffdc/api_corporate-accounts\");","module.exports = require(\"@nestjs/core\");","import { Module } from '@nestjs/common';\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport { ServeStaticModule } from '@nestjs/serve-static';\nimport { OidcModule } from '@ffdc/nestjs-oidc';\nimport { ProxyModule } from '@ffdc/nestjs-proxy';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { ProxyConfigService } from './configs/proxy-config.service';\nimport { GraphQLModule } from '@nestjs/graphql';\nimport { CorporateAccountsModule } from '@ffdc/api_corporate-accounts';\nimport { GqlConfigService } from './configs/graphql-config.service';\nimport { OidcConfigService } from './configs/oidc-config.service';\nimport { ServiceStaticConfigService } from './configs/serve-startic-config.service';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      isGlobal: true,\n      ignoreEnvFile: process.env.NODE_ENV === 'production',\n    }),\n    OidcModule.forRootAsync({\n      imports: [ConfigModule],\n      useClass: OidcConfigService,\n    }),\n    ServeStaticModule.forRootAsync({\n      useClass: ServiceStaticConfigService,\n    }),\n    ProxyModule.forRootAsync({\n      useClass: ProxyConfigService,\n      imports: [ConfigModule],\n    }),\n    CorporateAccountsModule,\n    GraphQLModule.forRootAsync({\n      useClass: GqlConfigService,\n    }),\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n","module.exports = require(\"@nestjs/serve-static\");","module.exports = require(\"@ffdc/nestjs-proxy\");","import { Controller, Get, UseGuards, Request } from '@nestjs/common';\nimport { AppService } from './app.service';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @Get('/user')\n  user(@Request() req) {\n    return req.user.userinfo;\n  }\n}\n","import { ConfigService } from '@nestjs/config';\nimport { Injectable } from '@nestjs/common';\nimport {\n  ProxyModuleOptions,\n  ProxyModuleOptionsFactory,\n} from '@ffdc/nestjs-proxy';\n\n@Injectable()\nexport class ProxyConfigService implements ProxyModuleOptionsFactory {\n  constructor(private configService: ConfigService) {}\n\n  createModuleConfig(): ProxyModuleOptions {\n    const FFDC = this.configService.get('FFDC');\n\n    const services = [\n      {\n        id: 'CORPORATE_ACCOUNTS',\n        url: `${FFDC}/corporate/channels/accounts/me/v1/accounts`,\n      },\n    ];\n\n    return {\n      services,\n    };\n  }\n}\n","module.exports = require(\"@nestjs/graphql\");","import { GqlOptionsFactory, GqlModuleOptions } from '@nestjs/graphql';\nimport { Injectable } from '@nestjs/common';\nimport { CorporateAccountsModule } from '@ffdc/api_corporate-accounts';\n\n@Injectable()\nexport class GqlConfigService implements GqlOptionsFactory {\n  createGqlOptions(): GqlModuleOptions {\n    const playgroundDevOptions = {\n      settings: {\n        'request.credentials': 'include',\n      },\n    };\n    return {\n      typePaths: ['./node_modules/@ffdc/api_corporate-accounts/**/*.graphql'],\n      include: [CorporateAccountsModule],\n      playground:\n        process.env.NODE_ENV === 'production' ? false : playgroundDevOptions,\n    };\n  }\n}\n","import { Injectable, Logger } from '@nestjs/common';\nimport { OidcOptionsFactory, OidcModuleOptions } from '@ffdc/nestjs-oidc';\nimport { ConfigService } from '@nestjs/config';\n\n@Injectable()\nexport class OidcConfigService implements OidcOptionsFactory {\n  readonly logger = new Logger(OidcConfigService.name);\n\n  constructor(private configService: ConfigService) {}\n\n  createModuleConfig(): OidcModuleOptions {\n    const issuer = this.configService.get('OIDC_ISSUER');\n    const client_id = this.configService.get('OIDC_CLIENT_ID');\n    const origin = this.configService.get(\n      'OIDC_ORIGIN',\n      process.env.VERCEL_URL || this.getHerokuHost(process.env.HEROKU_APP_NAME)\n    );\n\n    this.logger.log(`\nissuer     : ${issuer}\nclient_id  : ${client_id}\norigin     : ${origin}`);\n\n    return {\n      issuer,\n      clientMetadata: {\n        client_id,\n        client_secret: this.configService.get('OIDC_CLIENT_SECRET'),\n      },\n      authParams: {\n        scopes: this.configService.get('OIDC_SCOPES'),\n        resource: this.configService.get('OIDC_RESOURCE'),\n      },\n      origin,\n    };\n  }\n\n  private getHerokuHost(appName: string) {\n    return `https://${appName}.herokuapp.com`;\n  }\n}\n","import { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport {\n  ServeStaticModuleOptionsFactory,\n  ServeStaticModuleOptions,\n} from '@nestjs/serve-static';\nimport { join } from 'path';\n\n@Injectable()\nexport class ServiceStaticConfigService\n  implements ServeStaticModuleOptionsFactory {\n  appFolder = join(__dirname, '../../..', 'dist/apps/client');\n\n  constructor(private configService: ConfigService) {}\n\n  createLoggerOptions(): ServeStaticModuleOptions[] {\n    return [\n      {\n        rootPath: this.appFolder,\n      },\n    ];\n  }\n}\n","module.exports = require(\"path\");","module.exports = require(\"compression\");","import { NestFactory, Reflector } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { setupSession, getTokenStore, TokenGuard } from '@ffdc/nestjs-oidc';\nimport { ConfigService } from '@nestjs/config';\nimport { setupStatic } from './setup-static';\nimport * as compression from 'compression';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  const issuer = app.get(ConfigService).get('OIDC_ISSUER');\n  const tokenStore = await getTokenStore(issuer);\n  const reflector = app.get(Reflector);\n  app.useGlobalGuards(new TokenGuard(tokenStore, reflector));\n\n  app.use(compression());\n\n  setupSession(app);\n  //setupStatic(app);\n\n  const port = process.env.PORT || 3000;\n  await app.listen(port);\n}\nbootstrap();\n"],"sourceRoot":""}